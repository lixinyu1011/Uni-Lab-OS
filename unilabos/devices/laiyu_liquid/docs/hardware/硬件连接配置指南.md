# LaiYuæ¶²ä½“å¤„ç†è®¾å¤‡ç¡¬ä»¶è¿æ¥é…ç½®æŒ‡å—

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æŒ‡å—æä¾›LaiYuæ¶²ä½“å¤„ç†è®¾å¤‡çš„å®Œæ•´ç¡¬ä»¶è¿æ¥é…ç½®æ–¹æ¡ˆï¼ŒåŒ…æ‹¬å¿«é€Ÿå…¥é—¨ã€è¯¦ç»†é…ç½®ã€è¿æ¥éªŒè¯å’Œæ•…éšœæ’é™¤ã€‚é€‚ç”¨äºè®¾å¤‡åˆæ¬¡å®‰è£…ã€é…ç½®å˜æ›´å’Œé—®é¢˜è¯Šæ–­ã€‚

---

## ğŸš€ å¿«é€Ÿå…¥é—¨æŒ‡å—

### åŸºæœ¬é…ç½®æ­¥éª¤

1. **ç¡®è®¤ç¡¬ä»¶è¿æ¥**
   - å°†RS485è½¬USBè®¾å¤‡è¿æ¥åˆ°è®¡ç®—æœº
   - ç¡®ä¿XYZæ§åˆ¶å™¨å’Œç§»æ¶²å™¨é€šè¿‡RS485æ€»çº¿è¿æ¥
   - æ£€æŸ¥è®¾å¤‡ä¾›ç”µçŠ¶æ€

2. **è·å–ä¸²å£ä¿¡æ¯**
   ```bash
   # macOS/Linux
   ls /dev/cu.* | grep usbserial
   
   # å¸¸è§è¾“å‡º: /dev/cu.usbserial-3130
   ```

3. **åŸºæœ¬é…ç½®å‚æ•°**
   ```python
   # æ¨èçš„é»˜è®¤é…ç½®
   config = LaiYuLiquidConfig(
       port="/dev/cu.usbserial-3130",  # ğŸ”§ æ›¿æ¢ä¸ºå®é™…ä¸²å£å·
       address=4,                       # ç§»æ¶²å™¨åœ°å€ï¼ˆå›ºå®šï¼‰
       baudrate=115200,                 # æ¨èæ³¢ç‰¹ç‡
       timeout=5.0                      # é€šä¿¡è¶…æ—¶
   )
   ```

4. **å¿«é€Ÿè¿æ¥æµ‹è¯•**
   ```python
   device = LaiYuLiquid(config)
   success = await device.setup()
   print(f"è¿æ¥çŠ¶æ€: {'æˆåŠŸ' if success else 'å¤±è´¥'}")
   ```

---

## ğŸ—ï¸ ç¡¬ä»¶æ¶æ„è¯¦è§£

### ç³»ç»Ÿç»„æˆ

LaiYuæ¶²ä½“å¤„ç†è®¾å¤‡é‡‡ç”¨RS485æ€»çº¿æ¶æ„ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š

| ç»„ä»¶ | é€šä¿¡åè®® | è®¾å¤‡åœ°å€ | é»˜è®¤æ³¢ç‰¹ç‡ | åŠŸèƒ½æè¿° |
|------|----------|----------|------------|----------|
| **XYZä¸‰è½´æ§åˆ¶å™¨** | RS485 (Modbus) | Xè½´=1, Yè½´=2, Zè½´=3 | 115200 | ä¸‰ç»´è¿åŠ¨æ§åˆ¶ |
| **SOPAç§»æ¶²å™¨** | RS485 | 4 (æ¨è) | 115200 | æ¶²ä½“å¸å–åˆ†é… |
| **RS485è½¬USB** | USB/ä¸²å£ | - | 115200 | é€šä¿¡æ¥å£è½¬æ¢ |

### åœ°å€åˆ†é…ç­–ç•¥

```
RS485æ€»çº¿åœ°å€åˆ†é…:
â”œâ”€â”€ åœ°å€ 1: Xè½´æ­¥è¿›ç”µæœº (è‡ªåŠ¨åˆ†é…)
â”œâ”€â”€ åœ°å€ 2: Yè½´æ­¥è¿›ç”µæœº (è‡ªåŠ¨åˆ†é…)  
â”œâ”€â”€ åœ°å€ 3: Zè½´æ­¥è¿›ç”µæœº (è‡ªåŠ¨åˆ†é…)
â”œâ”€â”€ åœ°å€ 4: SOPAç§»æ¶²å™¨ (æ¨èé…ç½®)
â””â”€â”€ ç¦ç”¨åœ°å€: 47('/'), 69('E'), 91('[')
```

### é€šä¿¡å‚æ•°è§„èŒƒ

| å‚æ•° | XYZæ§åˆ¶å™¨ | SOPAç§»æ¶²å™¨ | è¯´æ˜ |
|------|-----------|------------|------|
| **æ•°æ®ä½** | 8 | 8 | å›ºå®šå€¼ |
| **åœæ­¢ä½** | 1 | 1 | å›ºå®šå€¼ |
| **æ ¡éªŒä½** | æ—  | æ—  | å›ºå®šå€¼ |
| **æµæ§åˆ¶** | æ—  | æ—  | å›ºå®šå€¼ |

---

## âš™ï¸ é…ç½®å‚æ•°è¯¦è§£

### 1. æ ¸å¿ƒé…ç½®ç±»

#### LaiYuLiquidConfig å‚æ•°è¯´æ˜

```python
@dataclass
class LaiYuLiquidConfig:
    # === é€šä¿¡å‚æ•° ===
    port: str = "/dev/cu.usbserial-3130"    # ä¸²å£è®¾å¤‡è·¯å¾„
    address: int = 4                         # ç§»æ¶²å™¨åœ°å€ï¼ˆæ¨èå€¼ï¼‰
    baudrate: int = 115200                   # é€šä¿¡æ³¢ç‰¹ç‡ï¼ˆæ¨èå€¼ï¼‰
    timeout: float = 5.0                     # é€šä¿¡è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    
    # === å·¥ä½œå°ç‰©ç†å°ºå¯¸ ===
    deck_width: float = 340.0                # å·¥ä½œå°å®½åº¦ (mm)
    deck_height: float = 250.0               # å·¥ä½œå°é«˜åº¦ (mm) 
    deck_depth: float = 160.0                # å·¥ä½œå°æ·±åº¦ (mm)
    
    # === è¿åŠ¨æ§åˆ¶å‚æ•° ===
    max_speed: float = 100.0                 # æœ€å¤§ç§»åŠ¨é€Ÿåº¦ (mm/s)
    acceleration: float = 50.0               # åŠ é€Ÿåº¦ (mm/sÂ²)
    safe_height: float = 50.0                # å®‰å…¨ç§»åŠ¨é«˜åº¦ (mm)
    
    # === ç§»æ¶²å‚æ•° ===
    max_volume: float = 1000.0               # æœ€å¤§ç§»æ¶²ä½“ç§¯ (Î¼L)
    min_volume: float = 0.1                  # æœ€å°ç§»æ¶²ä½“ç§¯ (Î¼L)
    liquid_detection: bool = True            # å¯ç”¨æ¶²é¢æ£€æµ‹
    
    # === æªå¤´æ“ä½œå‚æ•° ===
    tip_pickup_speed: int = 30               # å–æªå¤´é€Ÿåº¦ (rpm)
    tip_pickup_acceleration: int = 500       # å–æªå¤´åŠ é€Ÿåº¦ (rpm/s)
    tip_pickup_depth: float = 10.0           # æªå¤´æ’å…¥æ·±åº¦ (mm)
    tip_drop_height: float = 10.0            # ä¸¢å¼ƒæªå¤´é«˜åº¦ (mm)
```

### 2. é…ç½®æ–‡ä»¶ä½ç½®

#### A. ä»£ç é…ç½®ï¼ˆæ¨èï¼‰
```python
# åœ¨Pythonä»£ç ä¸­ç›´æ¥é…ç½®
from unilabos.devices.laiyu_liquid import LaiYuLiquidConfig

config = LaiYuLiquidConfig(
    port="/dev/cu.usbserial-3130",  # ğŸ”§ ä¿®æ”¹ä¸ºå®é™…ä¸²å£
    address=4,                       # ğŸ”§ ç§»æ¶²å™¨åœ°å€
    baudrate=115200,                 # ğŸ”§ é€šä¿¡æ³¢ç‰¹ç‡
    timeout=5.0                      # ğŸ”§ è¶…æ—¶æ—¶é—´
)
```

#### B. JSONé…ç½®æ–‡ä»¶
```json
{
    "laiyu_liquid_config": {
        "port": "/dev/cu.usbserial-3130",
        "address": 4,
        "baudrate": 115200,
        "timeout": 5.0,
        "deck_width": 340.0,
        "deck_height": 250.0,
        "deck_depth": 160.0,
        "max_speed": 100.0,
        "acceleration": 50.0,
        "safe_height": 50.0
    }
}
```

#### C. å®éªŒåè®®é…ç½®
```json
// test/experiments/laiyu_liquid.json
{
    "device_config": {
        "type": "laiyu_liquid",
        "config": {
            "port": "/dev/cu.usbserial-3130",
            "address": 4,
            "baudrate": 115200
        }
    }
}
```

### 2. ä¸²å£è®¾å¤‡è¯†åˆ«

#### è‡ªåŠ¨è¯†åˆ«æ–¹æ³•ï¼ˆæ¨èï¼‰

```python
import serial.tools.list_ports

def find_laiyu_device():
    """è‡ªåŠ¨æŸ¥æ‰¾LaiYuè®¾å¤‡ä¸²å£"""
    ports = serial.tools.list_ports.comports()
    
    for port in ports:
        # æ ¹æ®è®¾å¤‡æè¿°æˆ–VID/PIDè¯†åˆ«
        if 'usbserial' in port.device.lower():
            print(f"æ‰¾åˆ°å¯èƒ½çš„è®¾å¤‡: {port.device}")
            print(f"æè¿°: {port.description}")
            print(f"ç¡¬ä»¶ID: {port.hwid}")
            return port.device
    
    return None

# ä½¿ç”¨ç¤ºä¾‹
device_port = find_laiyu_device()
if device_port:
    print(f"æ£€æµ‹åˆ°è®¾å¤‡ç«¯å£: {device_port}")
else:
    print("æœªæ£€æµ‹åˆ°è®¾å¤‡")
```

#### æ‰‹åŠ¨è¯†åˆ«æ–¹æ³•

| æ“ä½œç³»ç»Ÿ | å‘½ä»¤ | è®¾å¤‡è·¯å¾„æ ¼å¼ |
|---------|------|-------------|
| **macOS** | `ls /dev/cu.*` | `/dev/cu.usbserial-XXXX` |
| **Linux** | `ls /dev/ttyUSB*` | `/dev/ttyUSB0` |
| **Windows** | è®¾å¤‡ç®¡ç†å™¨ | `COM3`, `COM4` ç­‰ |

#### macOS è¯¦ç»†è¯†åˆ«
```bash
# 1. åˆ—å‡ºæ‰€æœ‰USBä¸²å£è®¾å¤‡
ls /dev/cu.usbserial-*

# 2. æŸ¥çœ‹USBè®¾å¤‡è¯¦ç»†ä¿¡æ¯
system_profiler SPUSBDataType | grep -A 10 "Serial"

# 3. å®æ—¶ç›‘æ§è®¾å¤‡æ’æ‹”
ls /dev/cu.* && echo "--- è¯·æ’å…¥è®¾å¤‡ ---" && sleep 3 && ls /dev/cu.*
```

#### Linux è¯¦ç»†è¯†åˆ«
```bash
# 1. åˆ—å‡ºä¸²å£è®¾å¤‡
ls /dev/ttyUSB* /dev/ttyACM*

# 2. æŸ¥çœ‹è®¾å¤‡ä¿¡æ¯
dmesg | grep -i "usb.*serial"
lsusb | grep -i "serial\|converter"

# 3. æŸ¥çœ‹è®¾å¤‡å±æ€§
udevadm info --name=/dev/ttyUSB0 --attribute-walk
```

#### Windows è¯¦ç»†è¯†åˆ«
```powershell
# PowerShellå‘½ä»¤
Get-WmiObject -Class Win32_SerialPort | Select-Object Name, DeviceID, Description

# æˆ–åœ¨è®¾å¤‡ç®¡ç†å™¨ä¸­æŸ¥çœ‹"ç«¯å£(COMå’ŒLPT)"
```

### 3. æ§åˆ¶å™¨ç‰¹å®šé…ç½®

#### XYZæ­¥è¿›ç”µæœºæ§åˆ¶å™¨
- **åœ°å€èŒƒå›´**: 1-3 (Xè½´=1, Yè½´=2, Zè½´=3)
- **é€šä¿¡åè®®**: Modbus RTU
- **æ³¢ç‰¹ç‡**: 9600 æˆ– 115200
- **æ•°æ®ä½**: 8
- **åœæ­¢ä½**: 1
- **æ ¡éªŒä½**: None

#### XYZæ§åˆ¶å™¨é…ç½® (`controllers/xyz_controller.py`)

XYZæ§åˆ¶å™¨è´Ÿè´£ä¸‰è½´è¿åŠ¨æ§åˆ¶ï¼Œæä¾›ç²¾ç¡®çš„ä½ç½®æ§åˆ¶å’Œè¿åŠ¨è§„åˆ’åŠŸèƒ½ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- ä¸‰è½´ç‹¬ç«‹æ§åˆ¶ï¼ˆXã€Yã€Zè½´ï¼‰
- ä½ç½®ç²¾åº¦æ§åˆ¶
- è¿åŠ¨é€Ÿåº¦è°ƒèŠ‚
- å®‰å…¨é™ä½æ£€æµ‹

**é…ç½®å‚æ•°ï¼š**
```python
xyz_config = {
    "port": "/dev/ttyUSB0",           # ä¸²å£è®¾å¤‡
    "baudrate": 115200,               # æ³¢ç‰¹ç‡
    "timeout": 1.0,                   # é€šä¿¡è¶…æ—¶
    "max_speed": {                    # æœ€å¤§é€Ÿåº¦é™åˆ¶
        "x": 1000,                    # Xè½´æœ€å¤§é€Ÿåº¦
        "y": 1000,                    # Yè½´æœ€å¤§é€Ÿåº¦  
        "z": 500                      # Zè½´æœ€å¤§é€Ÿåº¦
    },
    "acceleration": 500,              # åŠ é€Ÿåº¦
    "home_position": [0, 0, 0]        # åŸç‚¹ä½ç½®
}
```

```python
def __init__(self, port: str, baudrate: int = 115200, 
             machine_config: Optional[MachineConfig] = None,
             config_file: str = "machine_config.json",
             auto_connect: bool = True):
    """
    Args:
        port: ä¸²å£ç«¯å£ (å¦‚: "/dev/cu.usbserial-3130")
        baudrate: æ³¢ç‰¹ç‡ (é»˜è®¤: 115200)
        machine_config: æœºæ¢°é…ç½®å‚æ•°
        config_file: é…ç½®æ–‡ä»¶è·¯å¾„
        auto_connect: æ˜¯å¦è‡ªåŠ¨è¿æ¥
    """
```

#### SOPAç§»æ¶²å™¨
- **åœ°å€**: é€šå¸¸ä¸º 4 æˆ–æ›´é«˜
- **é€šä¿¡åè®®**: è‡ªå®šä¹‰åè®®
- **æ³¢ç‰¹ç‡**: 115200 (æ¨è)
- **å“åº”æ—¶é—´**: < 100ms

#### ç§»æ¶²å™¨æ§åˆ¶å™¨é…ç½® (`controllers/pipette_controller.py`)

ç§»æ¶²å™¨æ§åˆ¶å™¨è´Ÿè´£ç²¾ç¡®çš„æ¶²ä½“å¸å–å’Œåˆ†é…æ“ä½œï¼Œæ”¯æŒå¤šç§ç§»æ¶²æ¨¡å¼å’Œå‚æ•°é…ç½®ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- ç²¾ç¡®ä½“ç§¯æ§åˆ¶
- æ¶²é¢æ£€æµ‹
- æªå¤´ç®¡ç†
- é€Ÿåº¦è°ƒèŠ‚

**é…ç½®å‚æ•°ï¼š**
```python
@dataclass
class SOPAConfig:
    # é€šä¿¡å‚æ•°
    port: str = "/dev/ttyUSB0"              # ğŸ”§ ä¿®æ”¹ä¸²å£å·
    baudrate: int = 115200                  # ğŸ”§ ä¿®æ”¹æ³¢ç‰¹ç‡
    address: int = 1                        # ğŸ”§ ä¿®æ”¹è®¾å¤‡åœ°å€ (1-254)
    timeout: float = 5.0                    # ğŸ”§ ä¿®æ”¹è¶…æ—¶æ—¶é—´
    comm_type: CommunicationType = CommunicationType.TERMINAL_DEBUG
```

## ğŸ” è¿æ¥éªŒè¯ä¸æµ‹è¯•

### 1. ç¼–ç¨‹æ–¹å¼éªŒè¯è¿æ¥

#### åˆ›å»ºæµ‹è¯•è„šæœ¬
```python
#!/usr/bin/env python3
"""
LaiYuæ¶²ä½“å¤„ç†è®¾å¤‡è¿æ¥æµ‹è¯•è„šæœ¬
"""

import sys
import os
sys.path.append('/Users/dp/Documents/DPT/HuaiRou/Uni-Lab-OS')

from unilabos.devices.laiyu_liquid.core.LaiYu_Liquid import (
    LaiYuLiquid, LaiYuLiquidConfig
)

def test_connection():
    """æµ‹è¯•è®¾å¤‡è¿æ¥"""
    
    # ğŸ”§ ä¿®æ”¹è¿™é‡Œçš„é…ç½®å‚æ•°
    config = LaiYuLiquidConfig(
        port="/dev/cu.usbserial-3130",  # ä¿®æ”¹ä¸ºä½ çš„ä¸²å£å·
        address=1,                       # ä¿®æ”¹ä¸ºä½ çš„è®¾å¤‡åœ°å€
        baudrate=9600,                   # ä¿®æ”¹ä¸ºä½ çš„æ³¢ç‰¹ç‡
        timeout=5.0
    )
    
    print("ğŸ”Œ æ­£åœ¨æµ‹è¯•LaiYuæ¶²ä½“å¤„ç†è®¾å¤‡è¿æ¥...")
    print(f"ä¸²å£: {config.port}")
    print(f"æ³¢ç‰¹ç‡: {config.baudrate}")
    print(f"è®¾å¤‡åœ°å€: {config.address}")
    print("-" * 50)
    
    try:
        # åˆ›å»ºè®¾å¤‡å®ä¾‹
        device = LaiYuLiquid(config)
        
        # å°è¯•è¿æ¥å’Œåˆå§‹åŒ–
        print("ğŸ“¡ æ­£åœ¨è¿æ¥è®¾å¤‡...")
        success = await device.setup()
        
        if success:
            print("âœ… è®¾å¤‡è¿æ¥æˆåŠŸ!")
            print(f"è¿æ¥çŠ¶æ€: {device.is_connected}")
            print(f"åˆå§‹åŒ–çŠ¶æ€: {device.is_initialized}")
            print(f"å½“å‰ä½ç½®: {device.current_position}")
            
            # è·å–è®¾å¤‡çŠ¶æ€
            status = device.get_status()
            print("\nğŸ“Š è®¾å¤‡çŠ¶æ€:")
            for key, value in status.items():
                print(f"  {key}: {value}")
                
        else:
            print("âŒ è®¾å¤‡è¿æ¥å¤±è´¥!")
            print("è¯·æ£€æŸ¥:")
            print("  1. ä¸²å£å·æ˜¯å¦æ­£ç¡®")
            print("  2. è®¾å¤‡æ˜¯å¦å·²è¿æ¥å¹¶é€šç”µ")
            print("  3. æ³¢ç‰¹ç‡å’Œè®¾å¤‡åœ°å€æ˜¯å¦åŒ¹é…")
            print("  4. ä¸²å£æ˜¯å¦è¢«å…¶ä»–ç¨‹åºå ç”¨")
            
    except Exception as e:
        print(f"âŒ è¿æ¥æµ‹è¯•å‡ºé”™: {e}")
        print("\nğŸ”§ æ•…éšœæ’é™¤å»ºè®®:")
        print("  1. æ£€æŸ¥ä¸²å£è®¾å¤‡æ˜¯å¦å­˜åœ¨:")
        print("     macOS: ls /dev/cu.*")
        print("     Linux: ls /dev/ttyUSB* /dev/ttyACM*")
        print("  2. æ£€æŸ¥è®¾å¤‡æƒé™:")
        print("     sudo chmod 666 /dev/cu.usbserial-*")
        print("  3. æ£€æŸ¥è®¾å¤‡æ˜¯å¦è¢«å ç”¨:")
        print("     lsof | grep /dev/cu.usbserial")
        
    finally:
        # æ¸…ç†è¿æ¥
        if 'device' in locals():
            await device.stop()

if __name__ == "__main__":
    import asyncio
    asyncio.run(test_connection())
```

### 2. å‘½ä»¤è¡ŒéªŒè¯å·¥å…·

#### ä¸²å£é€šä¿¡æµ‹è¯•
```bash
# å®‰è£…ä¸²å£è°ƒè¯•å·¥å…·
pip install pyserial

# ä½¿ç”¨Pythonæµ‹è¯•ä¸²å£
python -c "
import serial
try:
    ser = serial.Serial('/dev/cu.usbserial-3130', 9600, timeout=1)
    print('ä¸²å£è¿æ¥æˆåŠŸ:', ser.is_open)
    ser.close()
except Exception as e:
    print('ä¸²å£è¿æ¥å¤±è´¥:', e)
"
```

#### è®¾å¤‡æƒé™æ£€æŸ¥
```bash
# macOS/Linux æ£€æŸ¥ä¸²å£æƒé™
ls -la /dev/cu.usbserial-*

# å¦‚æœæƒé™ä¸è¶³ï¼Œä¿®æ”¹æƒé™
sudo chmod 666 /dev/cu.usbserial-*

# æ£€æŸ¥ä¸²å£æ˜¯å¦è¢«å ç”¨
lsof | grep /dev/cu.usbserial
```

### 3. è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨

è®¾å¤‡æä¾›å¤šç§æ–¹å¼æ£€æŸ¥è¿æ¥çŠ¶æ€ï¼š

#### A. å±æ€§æ£€æŸ¥
```python
device = LaiYuLiquid(config)

# æ£€æŸ¥è¿æ¥çŠ¶æ€
print(f"è®¾å¤‡å·²è¿æ¥: {device.is_connected}")
print(f"è®¾å¤‡å·²åˆå§‹åŒ–: {device.is_initialized}")
print(f"æªå¤´å·²å®‰è£…: {device.tip_attached}")
print(f"å½“å‰ä½ç½®: {device.current_position}")
print(f"å½“å‰ä½“ç§¯: {device.current_volume}")
```

#### B. çŠ¶æ€å­—å…¸
```python
status = device.get_status()
print("å®Œæ•´è®¾å¤‡çŠ¶æ€:", status)

# è¾“å‡ºç¤ºä¾‹:
# {
#     'connected': True,
#     'initialized': True, 
#     'position': (0.0, 0.0, 50.0),
#     'tip_attached': False,
#     'current_volume': 0.0,
#     'last_error': None
# }
```

## ğŸ› ï¸ æ•…éšœæ’é™¤æŒ‡å—

### 1. è¿æ¥é—®é¢˜è¯Šæ–­

#### ğŸ” é—®é¢˜è¯Šæ–­æµç¨‹
```python
def diagnose_connection_issues():
    """è¿æ¥é—®é¢˜è¯Šæ–­å·¥å…·"""
    import serial.tools.list_ports
    import serial
    
    print("ğŸ” å¼€å§‹è¿æ¥é—®é¢˜è¯Šæ–­...")
    
    # 1. æ£€æŸ¥ä¸²å£è®¾å¤‡
    ports = list(serial.tools.list_ports.comports())
    if not ports:
        print("âŒ æœªæ£€æµ‹åˆ°ä»»ä½•ä¸²å£è®¾å¤‡")
        print("ğŸ’¡ è§£å†³æ–¹æ¡ˆ:")
        print("   - æ£€æŸ¥USBè¿æ¥çº¿")
        print("   - ç¡®è®¤è®¾å¤‡ç”µæº")
        print("   - å®‰è£…è®¾å¤‡é©±åŠ¨")
        return
    
    print(f"âœ… æ£€æµ‹åˆ° {len(ports)} ä¸ªä¸²å£è®¾å¤‡")
    for port in ports:
        print(f"   ğŸ“ {port.device}: {port.description}")
    
    # 2. æµ‹è¯•ä¸²å£è®¿é—®æƒé™
    for port in ports:
        try:
            with serial.Serial(port.device, 9600, timeout=1):
                print(f"âœ… {port.device}: è®¿é—®æƒé™æ­£å¸¸")
        except PermissionError:
            print(f"âŒ {port.device}: æƒé™ä¸è¶³")
            print("ğŸ’¡ è§£å†³æ–¹æ¡ˆ: sudo chmod 666 " + port.device)
        except Exception as e:
            print(f"âš ï¸ {port.device}: {e}")

# è¿è¡Œè¯Šæ–­
diagnose_connection_issues()
```

#### ğŸš« å¸¸è§è¿æ¥é”™è¯¯

| é”™è¯¯ç±»å‹ | ç—‡çŠ¶ | è§£å†³æ–¹æ¡ˆ |
|---------|------|----------|
| **è®¾å¤‡æœªæ‰¾åˆ°** | `FileNotFoundError: No such file or directory` | 1. æ£€æŸ¥USBè¿æ¥<br>2. ç¡®è®¤è®¾å¤‡é©±åŠ¨<br>3. é‡æ–°æ’æ‹”è®¾å¤‡ |
| **æƒé™ä¸è¶³** | `PermissionError: Permission denied` | 1. `sudo chmod 666 /dev/ttyUSB0`<br>2. æ·»åŠ ç”¨æˆ·åˆ°dialoutç»„<br>3. ä½¿ç”¨sudoè¿è¡Œ |
| **è®¾å¤‡å ç”¨** | `SerialException: Device or resource busy` | 1. å…³é—­å…¶ä»–ç¨‹åº<br>2. `lsof /dev/ttyUSB0`æŸ¥æ‰¾å ç”¨<br>3. é‡å¯ç³»ç»Ÿ |
| **é©±åŠ¨é—®é¢˜** | è®¾å¤‡ç®¡ç†å™¨æ˜¾ç¤ºæœªçŸ¥è®¾å¤‡ | 1. å®‰è£…CH340/CP210xé©±åŠ¨<br>2. æ›´æ–°ç³»ç»Ÿé©±åŠ¨<br>3. ä½¿ç”¨åŸè£…USBçº¿ |

### 2. é€šä¿¡é—®é¢˜è§£å†³

#### ğŸ“¡ é€šä¿¡å‚æ•°è°ƒè¯•
```python
def test_communication_parameters():
    """æµ‹è¯•ä¸åŒé€šä¿¡å‚æ•°"""
    import serial
    
    port = "/dev/cu.usbserial-3130"  # ä¿®æ”¹ä¸ºå®é™…ç«¯å£
    baudrates = [9600, 19200, 38400, 57600, 115200]
    
    for baudrate in baudrates:
        print(f"ğŸ”„ æµ‹è¯•æ³¢ç‰¹ç‡: {baudrate}")
        try:
            with serial.Serial(port, baudrate, timeout=2) as ser:
                # å‘é€æµ‹è¯•å‘½ä»¤
                test_cmd = b'\x01\x03\x00\x00\x00\x01\x84\x0A'
                ser.write(test_cmd)
                
                response = ser.read(100)
                if response:
                    print(f"   âœ… æˆåŠŸ: æ”¶åˆ° {len(response)} å­—èŠ‚")
                    print(f"   ğŸ“¦ æ•°æ®: {response.hex()}")
                    return baudrate
                else:
                    print(f"   âŒ æ— å“åº”")
        except Exception as e:
            print(f"   âŒ é”™è¯¯: {e}")
    
    return None
```

#### âš¡ é€šä¿¡æ•…éšœæ’é™¤

| é—®é¢˜ç±»å‹ | ç—‡çŠ¶ | è¯Šæ–­æ–¹æ³• | è§£å†³æ–¹æ¡ˆ |
|---------|------|----------|----------|
| **é€šä¿¡è¶…æ—¶** | `TimeoutError` | æ£€æŸ¥æ³¢ç‰¹ç‡å’Œè®¾å¤‡åœ°å€ | 1. è°ƒæ•´è¶…æ—¶æ—¶é—´<br>2. éªŒè¯æ³¢ç‰¹ç‡<br>3. æ£€æŸ¥è®¾å¤‡åœ°å€ |
| **æ•°æ®æ ¡éªŒé”™è¯¯** | `CRCError` | æ£€æŸ¥æ•°æ®å®Œæ•´æ€§ | 1. æ›´æ¢USBçº¿<br>2. é™ä½æ³¢ç‰¹ç‡<br>3. æ£€æŸ¥ç”µç£å¹²æ‰° |
| **åè®®é”™è¯¯** | å“åº”æ ¼å¼å¼‚å¸¸ | éªŒè¯å‘½ä»¤æ ¼å¼ | 1. æ£€æŸ¥åè®®ç‰ˆæœ¬<br>2. ç¡®è®¤è®¾å¤‡ç±»å‹<br>3. æ›´æ–°å›ºä»¶ |
| **é—´æ­‡æ€§æ•…éšœ** | æ—¶å¥½æ—¶å | ç›‘æ§è¿æ¥ç¨³å®šæ€§ | 1. æ£€æŸ¥è¿æ¥çº¿<br>2. ç¨³å®šç”µæº<br>3. å‡å°‘å¹²æ‰°æº |

### 3. è®¾å¤‡åŠŸèƒ½é—®é¢˜

#### ğŸ¯ è®¾å¤‡çŠ¶æ€æ£€æŸ¥
```python
def check_device_health():
    """è®¾å¤‡å¥åº·çŠ¶æ€æ£€æŸ¥"""
    from unilabos.devices.laiyu_liquid import LaiYuLiquidConfig, LaiYuLiquidBackend
    
    config = LaiYuLiquidConfig(
        port="/dev/cu.usbserial-3130",
        address=4,
        baudrate=115200,
        timeout=5.0
    )
    
    try:
        backend = LaiYuLiquidBackend(config)
        backend.connect()
        
        # æ£€æŸ¥é¡¹ç›®
        checks = {
            "è®¾å¤‡è¿æ¥": lambda: backend.is_connected(),
            "XYZè½´çŠ¶æ€": lambda: backend.xyz_controller.get_all_positions(),
            "ç§»æ¶²å™¨çŠ¶æ€": lambda: backend.pipette_controller.get_status(),
            "è®¾å¤‡æ¸©åº¦": lambda: backend.get_temperature(),
            "é”™è¯¯çŠ¶æ€": lambda: backend.get_error_status(),
        }
        
        print("ğŸ¥ è®¾å¤‡å¥åº·æ£€æŸ¥æŠ¥å‘Š")
        print("=" * 40)
        
        for check_name, check_func in checks.items():
            try:
                result = check_func()
                print(f"âœ… {check_name}: æ­£å¸¸")
                if result:
                    print(f"   ğŸ“Š æ•°æ®: {result}")
            except Exception as e:
                print(f"âŒ {check_name}: å¼‚å¸¸ - {e}")
        
        backend.disconnect()
        
    except Exception as e:
        print(f"âŒ æ— æ³•è¿æ¥è®¾å¤‡: {e}")
```

### 4. é«˜çº§æ•…éšœæ’é™¤

#### ğŸ”§ æ—¥å¿—åˆ†æå·¥å…·
```python
import logging

def setup_debug_logging():
    """è®¾ç½®è°ƒè¯•æ—¥å¿—"""
    logging.basicConfig(
        level=logging.DEBUG,
        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
        handlers=[
            logging.FileHandler('laiyu_debug.log'),
            logging.StreamHandler()
        ]
    )
    
    # å¯ç”¨ä¸²å£é€šä¿¡æ—¥å¿—
    serial_logger = logging.getLogger('serial')
    serial_logger.setLevel(logging.DEBUG)
    
    print("ğŸ” è°ƒè¯•æ—¥å¿—å·²å¯ç”¨ï¼Œæ—¥å¿—æ–‡ä»¶: laiyu_debug.log")
```

#### ğŸ“Š æ€§èƒ½ç›‘æ§
```python
def monitor_performance():
    """æ€§èƒ½ç›‘æ§å·¥å…·"""
    import time
    import psutil
    
    print("ğŸ“Š å¼€å§‹æ€§èƒ½ç›‘æ§...")
    
    start_time = time.time()
    start_cpu = psutil.cpu_percent()
    start_memory = psutil.virtual_memory().percent
    
    # æ‰§è¡Œè®¾å¤‡æ“ä½œ
    # ... ä½ çš„è®¾å¤‡æ“ä½œä»£ç  ...
    
    end_time = time.time()
    end_cpu = psutil.cpu_percent()
    end_memory = psutil.virtual_memory().percent
    
    print(f"â±ï¸ æ‰§è¡Œæ—¶é—´: {end_time - start_time:.2f} ç§’")
    print(f"ğŸ’» CPUä½¿ç”¨: {end_cpu - start_cpu:.1f}%")
    print(f"ğŸ§  å†…å­˜ä½¿ç”¨: {end_memory - start_memory:.1f}%")
```

## ğŸ“ é…ç½®æ–‡ä»¶æ¨¡æ¿

### 1. åŸºç¡€é…ç½®æ¨¡æ¿

#### æ ‡å‡†é…ç½®ï¼ˆæ¨èï¼‰
```python
from unilabos.devices.laiyu_liquid import LaiYuLiquidConfig, LaiYuLiquidBackend, LaiYuLiquid

# åˆ›å»ºæ ‡å‡†é…ç½®
config = LaiYuLiquidConfig(
    # === é€šä¿¡å‚æ•° ===
    port="/dev/cu.usbserial-3130",    # ğŸ”§ ä¿®æ”¹ä¸ºå®é™…ä¸²å£
    address=4,                         # ç§»æ¶²å™¨åœ°å€ï¼ˆæ¨èï¼‰
    baudrate=115200,                   # é€šä¿¡æ³¢ç‰¹ç‡ï¼ˆæ¨èï¼‰
    timeout=5.0,                       # é€šä¿¡è¶…æ—¶æ—¶é—´
    
    # === å·¥ä½œå°å°ºå¯¸ ===
    deck_width=340.0,                  # å·¥ä½œå°å®½åº¦ (mm)
    deck_height=250.0,                 # å·¥ä½œå°é«˜åº¦ (mm)
    deck_depth=160.0,                  # å·¥ä½œå°æ·±åº¦ (mm)
    
    # === è¿åŠ¨æ§åˆ¶å‚æ•° ===
    max_speed=100.0,                   # æœ€å¤§ç§»åŠ¨é€Ÿåº¦ (mm/s)
    acceleration=50.0,                 # åŠ é€Ÿåº¦ (mm/sÂ²)
    safe_height=50.0,                  # å®‰å…¨ç§»åŠ¨é«˜åº¦ (mm)
    
    # === ç§»æ¶²å‚æ•° ===
    max_volume=1000.0,                 # æœ€å¤§ç§»æ¶²ä½“ç§¯ (Î¼L)
    min_volume=0.1,                    # æœ€å°ç§»æ¶²ä½“ç§¯ (Î¼L)
    liquid_detection=True,             # å¯ç”¨æ¶²é¢æ£€æµ‹
    
    # === æªå¤´æ“ä½œå‚æ•° ===
    tip_pickup_speed=30,               # å–æªå¤´é€Ÿåº¦ (rpm)
    tip_pickup_acceleration=500,       # å–æªå¤´åŠ é€Ÿåº¦ (rpm/s)
    tip_pickup_depth=10.0,             # æªå¤´æ’å…¥æ·±åº¦ (mm)
    tip_drop_height=10.0,              # ä¸¢å¼ƒæªå¤´é«˜åº¦ (mm)
)

# åˆ›å»ºè®¾å¤‡å®ä¾‹
backend = LaiYuLiquidBackend(config)
device = LaiYuLiquid(backend)
```

### 2. é«˜çº§é…ç½®æ¨¡æ¿

#### å¤šè®¾å¤‡é…ç½®
```python
# é…ç½®å¤šä¸ªLaiYuè®¾å¤‡
configs = {
    "device_1": LaiYuLiquidConfig(
        port="/dev/cu.usbserial-3130",
        address=4,
        baudrate=115200,
        deck_width=340.0,
        deck_height=250.0,
        deck_depth=160.0
    ),
    "device_2": LaiYuLiquidConfig(
        port="/dev/cu.usbserial-3131",
        address=4,
        baudrate=115200,
        deck_width=340.0,
        deck_height=250.0,
        deck_depth=160.0
    )
}

# åˆ›å»ºè®¾å¤‡å®ä¾‹
devices = {}
for name, config in configs.items():
    backend = LaiYuLiquidBackend(config)
    devices[name] = LaiYuLiquid(backend)
```

#### è‡ªå®šä¹‰å‚æ•°é…ç½®
```python
# é«˜ç²¾åº¦ç§»æ¶²é…ç½®
precision_config = LaiYuLiquidConfig(
    port="/dev/cu.usbserial-3130",
    address=4,
    baudrate=115200,
    timeout=10.0,                      # å¢åŠ è¶…æ—¶æ—¶é—´
    
    # ç²¾å¯†è¿åŠ¨æ§åˆ¶
    max_speed=50.0,                    # é™ä½é€Ÿåº¦æé«˜ç²¾åº¦
    acceleration=25.0,                 # é™ä½åŠ é€Ÿåº¦
    safe_height=30.0,                  # é™ä½å®‰å…¨é«˜åº¦
    
    # ç²¾å¯†ç§»æ¶²å‚æ•°
    max_volume=200.0,                  # å°ä½“ç§¯ç§»æ¶²
    min_volume=0.5,                    # æé«˜æœ€å°ä½“ç§¯
    liquid_detection=True,
    
    # ç²¾å¯†æªå¤´æ“ä½œ
    tip_pickup_speed=15,               # é™ä½å–æªå¤´é€Ÿåº¦
    tip_pickup_acceleration=250,       # é™ä½åŠ é€Ÿåº¦
    tip_pickup_depth=8.0,              # å‡å°‘æ’å…¥æ·±åº¦
    tip_drop_height=5.0,               # é™ä½ä¸¢å¼ƒé«˜åº¦
)
```

### 3. å®éªŒåè®®é…ç½®

#### JSONé…ç½®æ–‡ä»¶æ¨¡æ¿
```json
{
    "experiment_name": "LaiYuæ¶²ä½“å¤„ç†å®éªŒ",
    "version": "1.0",
    "devices": {
        "laiyu_liquid": {
            "type": "LaiYu_Liquid",
            "config": {
                "port": "/dev/cu.usbserial-3130",
                "address": 4,
                "baudrate": 115200,
                "timeout": 5.0,
                "deck_width": 340.0,
                "deck_height": 250.0,
                "deck_depth": 160.0,
                "max_speed": 100.0,
                "acceleration": 50.0,
                "safe_height": 50.0,
                "max_volume": 1000.0,
                "min_volume": 0.1,
                "liquid_detection": true
            }
        }
    },
    "deck_layout": {
        "tip_rack": {
            "type": "tip_rack_96",
            "position": [10, 10, 0],
            "tips": "1000Î¼L"
        },
        "source_plate": {
            "type": "plate_96",
            "position": [100, 10, 0],
            "contents": "æ ·å“"
        },
        "dest_plate": {
            "type": "plate_96",
            "position": [200, 10, 0],
            "contents": "ç›®æ ‡"
        }
    }
}
```

### 4. å®Œæ•´é…ç½®ç¤ºä¾‹
```json
{
    "laiyu_liquid_config": {
        "communication": {
            "xyz_controller": {
                "port": "/dev/cu.usbserial-3130",
                "baudrate": 115200,
                "timeout": 5.0
            },
            "pipette_controller": {
                "port": "/dev/cu.usbserial-3131", 
                "baudrate": 115200,
                "address": 4,
                "timeout": 5.0
            }
        },
        "mechanical": {
            "deck_width": 340.0,
            "deck_height": 250.0,
            "deck_depth": 160.0,
            "safe_height": 50.0
        },
        "motion": {
            "max_speed": 100.0,
            "acceleration": 50.0,
            "tip_pickup_speed": 30,
            "tip_pickup_acceleration": 500
        },
        "safety": {
            "position_validation": true,
            "emergency_stop_enabled": true,
            "deck_width": 300.0,
            "deck_height": 200.0,
            "deck_depth": 100.0,
            "safe_height": 50.0
        }
    }
}
```

### 5. å®Œæ•´ä½¿ç”¨ç¤ºä¾‹

#### åŸºç¡€ç§»æ¶²æ“ä½œ
```python
async def basic_pipetting_example():
    """åŸºç¡€ç§»æ¶²æ“ä½œç¤ºä¾‹"""
    
    # 1. è®¾å¤‡åˆå§‹åŒ–
    config = LaiYuLiquidConfig(
        port="/dev/cu.usbserial-3130",
        address=4,
        baudrate=115200
    )
    
    backend = LaiYuLiquidBackend(config)
    device = LaiYuLiquid(backend)
    
    try:
        # 2. è®¾å¤‡è®¾ç½®
        await device.setup()
        print("âœ… è®¾å¤‡åˆå§‹åŒ–å®Œæˆ")
        
        # 3. å›åˆ°åŸç‚¹
        await device.home_all_axes()
        print("âœ… è½´å½’é›¶å®Œæˆ")
        
        # 4. å–æªå¤´
        tip_position = (50, 50, 10)  # æªå¤´æ¶ä½ç½®
        await device.pick_up_tip(tip_position)
        print("âœ… å–æªå¤´å®Œæˆ")
        
        # 5. ç§»æ¶²æ“ä½œ
        source_pos = (100, 100, 15)  # æºä½ç½®
        dest_pos = (200, 200, 15)    # ç›®æ ‡ä½ç½®
        volume = 100.0               # ç§»æ¶²ä½“ç§¯ (Î¼L)
        
        await device.aspirate(volume, source_pos)
        print(f"âœ… å¸å– {volume}Î¼L å®Œæˆ")
        
        await device.dispense(volume, dest_pos)
        print(f"âœ… åˆ†é… {volume}Î¼L å®Œæˆ")
        
        # 6. ä¸¢å¼ƒæªå¤´
        trash_position = (300, 300, 20)
        await device.drop_tip(trash_position)
        print("âœ… ä¸¢å¼ƒæªå¤´å®Œæˆ")
        
    except Exception as e:
        print(f"âŒ æ“ä½œå¤±è´¥: {e}")
        
    finally:
        # 7. æ¸…ç†èµ„æº
        await device.cleanup()
        print("âœ… è®¾å¤‡æ¸…ç†å®Œæˆ")

# è¿è¡Œç¤ºä¾‹
import asyncio
asyncio.run(basic_pipetting_example())
```

#### æ‰¹é‡å¤„ç†ç¤ºä¾‹
```python
async def batch_processing_example():
    """æ‰¹é‡å¤„ç†ç¤ºä¾‹"""
    
    config = LaiYuLiquidConfig(
        port="/dev/cu.usbserial-3130",
        address=4,
        baudrate=115200
    )
    
    backend = LaiYuLiquidBackend(config)
    device = LaiYuLiquid(backend)
    
    try:
        await device.setup()
        await device.home_all_axes()
        
        # å®šä¹‰ä½ç½®
        tip_rack = [(50 + i*9, 50, 10) for i in range(12)]  # 12ä¸ªæªå¤´ä½ç½®
        source_wells = [(100 + i*9, 100, 15) for i in range(12)]  # 12ä¸ªæºå­”
        dest_wells = [(200 + i*9, 200, 15) for i in range(12)]    # 12ä¸ªç›®æ ‡å­”
        
        # æ‰¹é‡ç§»æ¶²
        for i in range(12):
            print(f"ğŸ”„ å¤„ç†ç¬¬ {i+1} ä¸ªæ ·å“...")
            
            # å–æªå¤´
            await device.pick_up_tip(tip_rack[i])
            
            # ç§»æ¶²
            await device.aspirate(50.0, source_wells[i])
            await device.dispense(50.0, dest_wells[i])
            
            # ä¸¢å¼ƒæªå¤´
            await device.drop_tip((300, 300, 20))
            
            print(f"âœ… ç¬¬ {i+1} ä¸ªæ ·å“å¤„ç†å®Œæˆ")
        
        print("ğŸ‰ æ‰¹é‡å¤„ç†å®Œæˆ!")
        
    except Exception as e:
        print(f"âŒ æ‰¹é‡å¤„ç†å¤±è´¥: {e}")
        
    finally:
        await device.cleanup()

# è¿è¡Œæ‰¹é‡å¤„ç†
asyncio.run(batch_processing_example())
```

## ğŸ”§ è°ƒè¯•ä¸æ—¥å¿—ç®¡ç†

### 1. è°ƒè¯•æ¨¡å¼é…ç½®

#### å¯ç”¨å…¨å±€è°ƒè¯•
```python
import logging
from unilabos.devices.laiyu_liquid import LaiYuLiquidConfig, LaiYuLiquidBackend

# é…ç½®å…¨å±€æ—¥å¿—
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('laiyu_debug.log'),
        logging.StreamHandler()
    ]
)

# åˆ›å»ºè°ƒè¯•é…ç½®
debug_config = LaiYuLiquidConfig(
    port="/dev/cu.usbserial-3130",
    address=4,
    baudrate=115200,
    timeout=10.0,                    # å¢åŠ è¶…æ—¶æ—¶é—´ä¾¿äºè°ƒè¯•
    debug_mode=True                  # å¯ç”¨è°ƒè¯•æ¨¡å¼
)
```

#### åˆ†çº§æ—¥å¿—é…ç½®
```python
def setup_logging(log_level="INFO"):
    """è®¾ç½®åˆ†çº§æ—¥å¿—"""
    
    # æ—¥å¿—çº§åˆ«æ˜ å°„
    levels = {
        "DEBUG": logging.DEBUG,
        "INFO": logging.INFO,
        "WARNING": logging.WARNING,
        "ERROR": logging.ERROR
    }
    
    # åˆ›å»ºæ—¥å¿—è®°å½•å™¨
    logger = logging.getLogger('LaiYu_Liquid')
    logger.setLevel(levels.get(log_level, logging.INFO))
    
    # æ–‡ä»¶å¤„ç†å™¨
    file_handler = logging.FileHandler('laiyu_operations.log')
    file_formatter = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(funcName)s:%(lineno)d - %(message)s'
    )
    file_handler.setFormatter(file_formatter)
    
    # æ§åˆ¶å°å¤„ç†å™¨
    console_handler = logging.StreamHandler()
    console_formatter = logging.Formatter('%(levelname)s - %(message)s')
    console_handler.setFormatter(console_formatter)
    
    logger.addHandler(file_handler)
    logger.addHandler(console_handler)
    
    return logger

# ä½¿ç”¨ç¤ºä¾‹
logger = setup_logging("DEBUG")
logger.info("å¼€å§‹LaiYuè®¾å¤‡æ“ä½œ")
```

### 2. é€šä¿¡ç›‘æ§

#### ä¸²å£é€šä¿¡æ—¥å¿—
```python
def enable_serial_logging():
    """å¯ç”¨ä¸²å£é€šä¿¡æ—¥å¿—"""
    import serial
    
    # åˆ›å»ºä¸²å£æ—¥å¿—è®°å½•å™¨
    serial_logger = logging.getLogger('serial.communication')
    serial_logger.setLevel(logging.DEBUG)
    
    # åˆ›å»ºä¸“ç”¨çš„ä¸²å£æ—¥å¿—æ–‡ä»¶
    serial_handler = logging.FileHandler('laiyu_serial.log')
    serial_formatter = logging.Formatter(
        '%(asctime)s - SERIAL - %(message)s'
    )
    serial_handler.setFormatter(serial_formatter)
    serial_logger.addHandler(serial_handler)
    
    print("ğŸ“¡ ä¸²å£é€šä¿¡æ—¥å¿—å·²å¯ç”¨: laiyu_serial.log")
    return serial_logger
```

#### å®æ—¶é€šä¿¡ç›‘æ§
```python
class CommunicationMonitor:
    """é€šä¿¡ç›‘æ§å™¨"""
    
    def __init__(self):
        self.sent_count = 0
        self.received_count = 0
        self.error_count = 0
        self.start_time = time.time()
    
    def log_sent(self, data):
        """è®°å½•å‘é€æ•°æ®"""
        self.sent_count += 1
        logging.debug(f"ğŸ“¤ å‘é€ #{self.sent_count}: {data.hex()}")
    
    def log_received(self, data):
        """è®°å½•æ¥æ”¶æ•°æ®"""
        self.received_count += 1
        logging.debug(f"ğŸ“¥ æ¥æ”¶ #{self.received_count}: {data.hex()}")
    
    def log_error(self, error):
        """è®°å½•é”™è¯¯"""
        self.error_count += 1
        logging.error(f"âŒ é€šä¿¡é”™è¯¯ #{self.error_count}: {error}")
    
    def get_statistics(self):
        """è·å–ç»Ÿè®¡ä¿¡æ¯"""
        duration = time.time() - self.start_time
        return {
            "è¿è¡Œæ—¶é—´": f"{duration:.2f}ç§’",
            "å‘é€æ¬¡æ•°": self.sent_count,
            "æ¥æ”¶æ¬¡æ•°": self.received_count,
            "é”™è¯¯æ¬¡æ•°": self.error_count,
            "æˆåŠŸç‡": f"{((self.sent_count - self.error_count) / max(self.sent_count, 1) * 100):.1f}%"
        }
```

### 3. æ€§èƒ½ç›‘æ§

#### æ“ä½œæ€§èƒ½åˆ†æ
```python
import time
import functools

def performance_monitor(operation_name):
    """æ€§èƒ½ç›‘æ§è£…é¥°å™¨"""
    def decorator(func):
        @functools.wraps(func)
        async def wrapper(*args, **kwargs):
            start_time = time.time()
            start_memory = psutil.Process().memory_info().rss / 1024 / 1024  # MB
            
            try:
                result = await func(*args, **kwargs)
                
                end_time = time.time()
                end_memory = psutil.Process().memory_info().rss / 1024 / 1024  # MB
                
                duration = end_time - start_time
                memory_delta = end_memory - start_memory
                
                logging.info(f"â±ï¸ {operation_name}: {duration:.3f}s, å†…å­˜å˜åŒ–: {memory_delta:+.1f}MB")
                
                return result
                
            except Exception as e:
                end_time = time.time()
                duration = end_time - start_time
                logging.error(f"âŒ {operation_name} å¤±è´¥ ({duration:.3f}s): {e}")
                raise
                
        return wrapper
    return decorator

# ä½¿ç”¨ç¤ºä¾‹
@performance_monitor("ç§»æ¶²æ“ä½œ")
async def monitored_pipetting():
    await device.aspirate(100.0, (100, 100, 15))
    await device.dispense(100.0, (200, 200, 15))
```

#### ç³»ç»Ÿèµ„æºç›‘æ§
```python
import psutil
import threading
import time

class SystemMonitor:
    """ç³»ç»Ÿèµ„æºç›‘æ§å™¨"""
    
    def __init__(self, interval=1.0):
        self.interval = interval
        self.monitoring = False
        self.data = []
    
    def start_monitoring(self):
        """å¼€å§‹ç›‘æ§"""
        self.monitoring = True
        self.monitor_thread = threading.Thread(target=self._monitor_loop)
        self.monitor_thread.daemon = True
        self.monitor_thread.start()
        print("ğŸ“Š ç³»ç»Ÿç›‘æ§å·²å¯åŠ¨")
    
    def stop_monitoring(self):
        """åœæ­¢ç›‘æ§"""
        self.monitoring = False
        if hasattr(self, 'monitor_thread'):
            self.monitor_thread.join()
        print("ğŸ“Š ç³»ç»Ÿç›‘æ§å·²åœæ­¢")
    
    def _monitor_loop(self):
        """ç›‘æ§å¾ªç¯"""
        while self.monitoring:
            cpu_percent = psutil.cpu_percent()
            memory = psutil.virtual_memory()
            
            self.data.append({
                'timestamp': time.time(),
                'cpu_percent': cpu_percent,
                'memory_percent': memory.percent,
                'memory_used_mb': memory.used / 1024 / 1024
            })
            
            time.sleep(self.interval)
    
    def get_report(self):
        """ç”Ÿæˆç›‘æ§æŠ¥å‘Š"""
        if not self.data:
            return "æ— ç›‘æ§æ•°æ®"
        
        avg_cpu = sum(d['cpu_percent'] for d in self.data) / len(self.data)
        avg_memory = sum(d['memory_percent'] for d in self.data) / len(self.data)
        max_memory = max(d['memory_used_mb'] for d in self.data)
        
        return f"""
ğŸ“Š ç³»ç»Ÿèµ„æºç›‘æ§æŠ¥å‘Š
==================
ç›‘æ§æ—¶é•¿: {len(self.data) * self.interval:.1f}ç§’
å¹³å‡CPUä½¿ç”¨ç‡: {avg_cpu:.1f}%
å¹³å‡å†…å­˜ä½¿ç”¨ç‡: {avg_memory:.1f}%
å³°å€¼å†…å­˜ä½¿ç”¨: {max_memory:.1f}MB
        """

# ä½¿ç”¨ç¤ºä¾‹
monitor = SystemMonitor()
monitor.start_monitoring()

# æ‰§è¡Œè®¾å¤‡æ“ä½œ
# ... ä½ çš„ä»£ç  ...

monitor.stop_monitoring()
print(monitor.get_report())
```

### 4. é”™è¯¯è¿½è¸ª

#### å¼‚å¸¸å¤„ç†å’Œè®°å½•
```python
import traceback

class ErrorTracker:
    """é”™è¯¯è¿½è¸ªå™¨"""
    
    def __init__(self):
        self.errors = []
    
    def log_error(self, operation, error, context=None):
        """è®°å½•é”™è¯¯"""
        error_info = {
            'timestamp': time.time(),
            'operation': operation,
            'error_type': type(error).__name__,
            'error_message': str(error),
            'traceback': traceback.format_exc(),
            'context': context or {}
        }
        
        self.errors.append(error_info)
        
        # è®°å½•åˆ°æ—¥å¿—
        logging.error(f"âŒ {operation} å¤±è´¥: {error}")
        logging.debug(f"é”™è¯¯è¯¦æƒ…: {error_info}")
    
    def get_error_summary(self):
        """è·å–é”™è¯¯æ‘˜è¦"""
        if not self.errors:
            return "âœ… æ— é”™è¯¯è®°å½•"
        
        error_types = {}
        for error in self.errors:
            error_type = error['error_type']
            error_types[error_type] = error_types.get(error_type, 0) + 1
        
        summary = f"âŒ å…±è®°å½• {len(self.errors)} ä¸ªé”™è¯¯:\n"
        for error_type, count in error_types.items():
            summary += f"  - {error_type}: {count} æ¬¡\n"
        
        return summary

# å…¨å±€é”™è¯¯è¿½è¸ªå™¨
error_tracker = ErrorTracker()

# ä½¿ç”¨ç¤ºä¾‹
try:
    await device.move_to(x=1000, y=1000, z=100)  # å¯èƒ½è¶…å‡ºèŒƒå›´
except Exception as e:
    error_tracker.log_error("ç§»åŠ¨æ“ä½œ", e, {"target": (1000, 1000, 100)})
```

---

## ğŸ“š æ€»ç»“

æœ¬æ–‡æ¡£æä¾›äº†LaiYuæ¶²ä½“å¤„ç†è®¾å¤‡çš„å®Œæ•´ç¡¬ä»¶è¿æ¥é…ç½®æŒ‡å—ï¼Œæ¶µç›–äº†ä»åŸºç¡€è®¾ç½®åˆ°é«˜çº§æ•…éšœæ’é™¤çš„æ‰€æœ‰æ–¹é¢ã€‚

### ğŸ¯ å…³é”®è¦ç‚¹

1. **æ ‡å‡†é…ç½®**: ä½¿ç”¨ `port="/dev/cu.usbserial-3130"`, `address=4`, `baudrate=115200`
2. **è®¾å¤‡æ¶æ„**: XYZè½´æ§åˆ¶å™¨(åœ°å€1-3) + SOPAç§»æ¶²å™¨(åœ°å€4)
3. **è¿æ¥éªŒè¯**: ä½¿ç”¨æä¾›çš„æµ‹è¯•è„šæœ¬éªŒè¯ç¡¬ä»¶è¿æ¥
4. **æ•…éšœæ’é™¤**: å‚è€ƒæ•…éšœæ’é™¤æŒ‡å—è§£å†³å¸¸è§é—®é¢˜
5. **æ€§èƒ½ç›‘æ§**: å¯ç”¨æ—¥å¿—å’Œç›‘æ§ç¡®ä¿ç¨³å®šè¿è¡Œ

### ğŸ”— ç›¸å…³æ–‡æ¡£

- [LaiYuæ§åˆ¶æ¶æ„è¯¦è§£](./UniLab_LaiYu_æ§åˆ¶æ¶æ„è¯¦è§£.md)
- [XYZé›†æˆåŠŸèƒ½è¯´æ˜](./XYZ_é›†æˆåŠŸèƒ½è¯´æ˜.md)
- [è®¾å¤‡APIæ–‡æ¡£](./readme.md)

### ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æ£€æŸ¥ç¡¬ä»¶è¿æ¥å’Œé…ç½®
2. æŸ¥çœ‹è°ƒè¯•æ—¥å¿—
3. å‚è€ƒæ•…éšœæ’é™¤æŒ‡å—
4. è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ

---

*æœ€åæ›´æ–°: 2024å¹´1æœˆ*